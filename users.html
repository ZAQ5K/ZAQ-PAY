<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Users • Admin</title>

<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  background:#eef2f7;
  display:flex;
  justify-content:center;
  padding:40px;
}

table {
  border-collapse: collapse;
  width: 800px;
  background:#fff;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 8px 24px rgba(0,0,0,0.1);
}

th, td {
  padding:12px;
  border-bottom:1px solid #d1d5db;
  text-align:left;
}

th {
  background:#2563eb;
  color:#fff;
}

tr:hover { background:#f3f4f6; }

input {
  width:100%;
  padding:6px;
  border-radius:6px;
  border:1px solid #d1d5db;
}

button {
  padding:6px 10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}

.save-btn { background:#16a34a; color:white; }
.save-btn:hover { background:#15803d; }

.delete-btn { background:#ef4444; color:white; }
.delete-btn:hover { background:#b91c1c; }
</style>
</head>

<body>

<table>
<thead>
<tr>
  <th>#</th>
  <th>Нэр</th>
  <th>Email</th>
  <th>Password</th>
  <th>Мөнгө (₮)</th>
  <th>Үйлдэл</th>
</tr>
</thead>

<tbody id="userTable"></tbody>
</table>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAbcCE3MINVNUvMpw1YEFjrm9xJhCFgFHc",
    authDomain: "zaq-pay-a4256.firebaseapp.com",
    projectId: "zaq-pay-a4256",
    storageBucket: "zaq-pay-a4256.firebasestorage.app",
    messagingSenderId: "349261684381",
    appId: "1:349261684381:web:20816605dfbaacb4fbbe74"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const tbody = document.getElementById("userTable");
  let users = [];

  function render(){
    tbody.innerHTML = "";
    users.forEach((u, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i+1}</td>
        <td><input value="${u.name}"></td>
        <td>${u.email}</td>
        <td><input value="${u.pass}"></td>
        <td><input type="number" value="${u.wallet || 0}"></td>
        <td>
          <button class="save-btn" onclick="saveUser('${u.key}', this)">Хадгалах</button>
          <button class="delete-btn" onclick="deleteUser('${u.key}')">Устгах</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  // Firebase realtime listener
  db.ref('users').on('value', snapshot => {
    users = [];
    snapshot.forEach(child => {
      const u = child.val();
      u.key = child.key;
      users.push(u);
    });
    render();
  });

  function saveUser(key, btn){
    const row = btn.closest("tr");
    const inputs = row.querySelectorAll("input");

    const updatedData = {
      name: inputs[0].value.trim(),
      pass: inputs[1].value,
      wallet: Number(inputs[2].value) || 0
    };

    db.ref('users/' + key).update(updatedData)
      .then(()=>{
        alert("Амжилттай хадгалагдлаа!");
      }).catch(err=>{
        console.error(err);
        alert("Алдаа гарлаа!");
      });
  }

  function deleteUser(key){
    if(!confirm("Энэ хэрэглэгчийг устгах уу?")) return;

    // Хэрэв нэвтэрсэн хэрэглэгчийг устгах гэж байвал block
    const currentUser = JSON.parse(localStorage.getItem("currentUser"));
    const userToDelete = users.find(u => u.key === key);
    if(currentUser && userToDelete && currentUser.email === userToDelete.email){
      alert("Нэвтэрсэн хэрэглэгчийг устгах боломжгүй!");
      return;
    }

    db.ref('users/' + key).remove()
      .then(()=>{ alert("Хэрэглэгч устгагдлаа!"); })
      .catch(err=>{
        console.error(err);
        alert("Алдаа гарлаа!");
      });
  }
</script>

</body>
</html>
